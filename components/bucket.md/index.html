<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel=stylesheet href=https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/css/bootstrap.min.css integrity=sha384-GJzZqFGwb1QTTN6wy59ffF1BuGJpLSa9DkKMp0DgiMDm4iYMj70gZWKYbI706tWS crossorigin=anonymous><link rel=stylesheet href=https://use.fontawesome.com/releases/v5.7.1/css/all.css integrity=sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr crossorigin=anonymous><link rel=stylesheet href=https://improbable-eng.github.io/thanos/main.css><link rel=stylesheet href=https://improbable-eng.github.io/thanos/syntax.css><link rel=icon href=https://improbable-eng.github.io/thanos/icon-light.png><title>Thanos - Highly available Prometheus setup with long term storage capabilities</title><meta property=og:image content=/icon-light.png><meta property=og:type content=object><meta property=og:title content=Thanos><meta property=og:description content="Thanos - Highly available Prometheus setup with long term storage capabilities"></head><body><nav class="navbar navbar-expand-lg navbar-dark bg-purple"><a href=https://improbable-eng.github.io/thanos/ class=navbar-brand><img src=https://improbable-eng.github.io/thanos/icon-dark.png alt="Thanos logo"> Thanos</a>
<button class=navbar-toggler type=button data-toggle=collapse data-target=#navbarSupportedContent aria-controls=navbarSupportedContent aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse" id=navbarSupportedContent><ul class="navbar-nav ml-auto"><li class=nav-item><a class=nav-link href=https://improbable-eng.github.io/thanos/getting-started.md>Documentation</a></li><li class=nav-item><a class=nav-link href=https://github.com/improbable-eng/thanos/releases>Download</a></li><li class=nav-item><a href=https://github.com/improbable-eng/thanos class=nav-link><i class="fab fa-fw fa-github"></i>GitHub</a></li><li class=nav-item><a href=https://twitter.com/ThanosMetrics class=nav-link><i class="fab fa-fw fa-twitter"></i>Twitter</a></li></ul></div></nav><div class=container><div class="row py-3 py-lg-5"><div class="col-12 col-lg-3"><button class="btn btn-block btn-outline-secondary mb-3 d-block d-lg-none" type=button data-toggle=collapse data-target=.docs-menu>
Toggle Menu</button><nav class="docs-menu collapse d-lg-block"><h5>Thanos</h5><div class="list-group list-group-flush"><a class="list-group-item list-group-item-action list-group-item-thanos py-1" href=https://improbable-eng.github.io/thanos/getting-started.md/>Getting Started</a>
<a class="list-group-item list-group-item-action list-group-item-thanos py-1" href=https://improbable-eng.github.io/thanos/changelog/>Changelog</a>
<a class="list-group-item list-group-item-action list-group-item-thanos py-1" href=https://improbable-eng.github.io/thanos/design.md/>Design</a>
<a class="list-group-item list-group-item-action list-group-item-thanos py-1" href=https://improbable-eng.github.io/thanos/storage.md/>Object Storage</a>
<a class="list-group-item list-group-item-action list-group-item-thanos py-1" href=https://improbable-eng.github.io/thanos/service-discovery.md/>Service Discovery</a></div><h5 class=mt-3>Components</h5><div class="list-group list-group-flush"><a class="list-group-item list-group-item-action list-group-item-thanos py-1" href=https://improbable-eng.github.io/thanos/components/bucket.md/>Bucket</a>
<a class="list-group-item list-group-item-action list-group-item-thanos py-1" href=https://improbable-eng.github.io/thanos/components/compact.md/>Compact</a>
<a class="list-group-item list-group-item-action list-group-item-thanos py-1" href=https://improbable-eng.github.io/thanos/components/query.md/>Query</a>
<a class="list-group-item list-group-item-action list-group-item-thanos py-1" href=https://improbable-eng.github.io/thanos/components/rule.md/>Rule</a>
<a class="list-group-item list-group-item-action list-group-item-thanos py-1" href=https://improbable-eng.github.io/thanos/components/sidecar.md/>Sidecar</a>
<a class="list-group-item list-group-item-action list-group-item-thanos py-1" href=https://improbable-eng.github.io/thanos/components/store.md/>Store</a></div><h5 class=mt-3>Contributing</h5><div class="list-group list-group-flush"><a class="list-group-item list-group-item-action list-group-item-thanos py-1" href=https://improbable-eng.github.io/thanos/code_of_conduct/>Code of Conduct</a>
<a class="list-group-item list-group-item-action list-group-item-thanos py-1" href=https://improbable-eng.github.io/thanos/contributing/how-to-contribute-to-docs.md/>Contribute to docs</a>
<a class="list-group-item list-group-item-action list-group-item-thanos py-1" href=https://improbable-eng.github.io/thanos/contributing/>Contributing</a>
<a class="list-group-item list-group-item-action list-group-item-thanos py-1" href=https://improbable-eng.github.io/thanos/contributing/dev.md/>Troubleshooting for dev workflow</a></div><h5 class=mt-3>Proposals</h5><div class="list-group list-group-flush"><a class="list-group-item list-group-item-action list-group-item-thanos py-1" href=https://improbable-eng.github.io/thanos/proposals/201809_gossip-removal.md/>Deprecated gossip clustering in favor of File SD</a>
<a class="list-group-item list-group-item-action list-group-item-thanos py-1" href=https://improbable-eng.github.io/thanos/proposals/201807_store_instance_high_availability.md/>High-availability for store instances</a>
<a class="list-group-item list-group-item-action list-group-item-thanos py-1" href=https://improbable-eng.github.io/thanos/proposals/201901-read-write-operations-bucket.md/>Read-Write coordination free operational contract for object storage</a>
<a class="list-group-item list-group-item-action list-group-item-thanos py-1" href=https://improbable-eng.github.io/thanos/proposals/config.md/>Thanos Cluster Configuration</a>
<a class="list-group-item list-group-item-action list-group-item-thanos py-1" href=https://improbable-eng.github.io/thanos/proposals/201812_thanos-remote-receive.md/>Thanos Remote Write</a></div></nav></div><div class="col-12 col-lg-9"><h1 id=bucket>Bucket</h1><p>The bucket component of Thanos is a set of commands to inspect data in object storage buckets.
It is normally run as a stand alone command to aid with troubleshooting.</p><p>Example:</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>$ thanos bucket verify --objstore.config-file<span class=o>=</span>bucket.yml</code></pre></div><p>The content of <code>bucket.yml</code>:</p><div class=highlight><pre class=chroma><code class=language-yaml data-lang=yaml>type<span class=p>:</span><span class=w> </span>GCS<span class=w>
</span><span class=w></span>config<span class=p>:</span><span class=w>
</span><span class=w>  </span>bucket<span class=p>:</span><span class=w> </span>example-bucket</code></pre></div><p>Bucket can be extended to add more subcommands that will be helpful when working with object storage buckets
by adding a new command within <code>/cmd/thanos/bucket.go</code></p><h2 id=deployment>Deployment</h2><h2 id=flags>Flags</h2><div class=highlight><pre class=chroma><code class=language-$ data-lang=$>usage: thanos bucket [&lt;flags&gt;] &lt;command&gt; [&lt;args&gt; ...]

Bucket utility commands

Flags:
  -h, --help               Show context-sensitive help (also try --help-long and
                           --help-man).
      --version            Show application version.
      --log.level=info     Log filtering level.
      --log.format=logfmt  Log format to use.
      --gcloudtrace.project=GCLOUDTRACE.PROJECT
                           GCP project to send Google Cloud Trace tracings to.
                           If empty, tracing will be disabled.
      --gcloudtrace.sample-factor=1
                           How often we send traces (1/&lt;sample-factor&gt;). If 0 no
                           trace will be sent periodically, unless forced by
                           baggage item. See `pkg/tracing/tracing.go` for
                           details.
      --objstore.config-file=&lt;bucket.config-yaml-path&gt;
                           Path to YAML file that contains object store
                           configuration.
      --objstore.config=&lt;bucket.config-yaml&gt;
                           Alternative to &#39;objstore.config-file&#39; flag. Object
                           store configuration in YAML.

Subcommands:
  bucket verify [&lt;flags&gt;]
    Verify all blocks in the bucket against specified issues

  bucket ls [&lt;flags&gt;]
    List all blocks in the bucket

  bucket inspect [&lt;flags&gt;]
    Inspect all blocks in the bucket in detailed, table-like way</code></pre></div><h3 id=verify>Verify</h3><p><code>bucket verify</code> is used to verify and optionally repair blocks within the specified bucket.</p><p>Example:</p><pre><code>$ thanos bucket verify --gcs.bucket example-bucket
</code></pre><div class=highlight><pre class=chroma><code class=language-txt data-lang=txt>usage: thanos bucket verify [&lt;flags&gt;]

Verify all blocks in the bucket against specified issues

Flags:
  -h, --help               Show context-sensitive help (also try --help-long and
                           --help-man).
      --version            Show application version.
      --log.level=info     Log filtering level.
      --log.format=logfmt  Log format to use.
      --gcloudtrace.project=GCLOUDTRACE.PROJECT
                           GCP project to send Google Cloud Trace tracings to.
                           If empty, tracing will be disabled.
      --gcloudtrace.sample-factor=1
                           How often we send traces (1/&lt;sample-factor&gt;). If 0 no
                           trace will be sent periodically, unless forced by
                           baggage item. See `pkg/tracing/tracing.go` for
                           details.
      --objstore.config-file=&lt;bucket.config-yaml-path&gt;
                           Path to YAML file that contains object store
                           configuration.
      --objstore.config=&lt;bucket.config-yaml&gt;
                           Alternative to &#39;objstore.config-file&#39; flag. Object
                           store configuration in YAML.
      --objstore-backup.config-file=&lt;bucket.config-yaml-path&gt;
                           Path to YAML file that contains object store-backup
                           configuration. Used for repair logic to backup blocks
                           before removal.
      --objstore-backup.config=&lt;bucket.config-yaml&gt;
                           Alternative to &#39;objstore-backup.config-file&#39; flag.
                           Object store-backup configuration in YAML. Used for
                           repair logic to backup blocks before removal.
  -r, --repair             Attempt to repair blocks for which issues were
                           detected
  -i, --issues=index_issue... ...
                           Issues to verify (and optionally repair). Possible
                           values: [duplicated_compaction index_issue
                           overlapped_blocks]
      --id-whitelist=ID-WHITELIST ...
                           Block IDs to verify (and optionally repair) only. If
                           none is specified, all blocks will be verified.
                           Repeated field</code></pre></div><h3 id=ls>ls</h3><p><code>bucket ls</code> is used to list all blocks in the specified bucket.</p><p>Example:</p><pre><code>$ thanos bucket ls -o json --gcs.bucket example-bucket
</code></pre><div class=highlight><pre class=chroma><code class=language-txt data-lang=txt>usage: thanos bucket ls [&lt;flags&gt;]

List all blocks in the bucket

Flags:
  -h, --help               Show context-sensitive help (also try --help-long and
                           --help-man).
      --version            Show application version.
      --log.level=info     Log filtering level.
      --log.format=logfmt  Log format to use.
      --gcloudtrace.project=GCLOUDTRACE.PROJECT
                           GCP project to send Google Cloud Trace tracings to.
                           If empty, tracing will be disabled.
      --gcloudtrace.sample-factor=1
                           How often we send traces (1/&lt;sample-factor&gt;). If 0 no
                           trace will be sent periodically, unless forced by
                           baggage item. See `pkg/tracing/tracing.go` for
                           details.
      --objstore.config-file=&lt;bucket.config-yaml-path&gt;
                           Path to YAML file that contains object store
                           configuration.
      --objstore.config=&lt;bucket.config-yaml&gt;
                           Alternative to &#39;objstore.config-file&#39; flag. Object
                           store configuration in YAML.
  -o, --output=&#34;&#34;          Optional format in which to print each block&#39;s
                           information. Options are &#39;json&#39;, &#39;wide&#39; or a custom
                           template.</code></pre></div><h3 id=inspect>inspect</h3><p><code>bucket inspect</code> is used to inspect buckets in a detailed way.</p><p>Example:</p><pre><code>$ thanos bucket inspect -l environment=\&quot;prod\&quot;
</code></pre><div class=highlight><pre class=chroma><code class=language-txt data-lang=txt>usage: thanos bucket inspect [&lt;flags&gt;]

Inspect all blocks in the bucket in detailed, table-like way

Flags:
  -h, --help                 Show context-sensitive help (also try --help-long
                             and --help-man).
      --version              Show application version.
      --log.level=info       Log filtering level.
      --log.format=logfmt    Log format to use.
      --gcloudtrace.project=GCLOUDTRACE.PROJECT
                             GCP project to send Google Cloud Trace tracings to.
                             If empty, tracing will be disabled.
      --gcloudtrace.sample-factor=1
                             How often we send traces (1/&lt;sample-factor&gt;). If 0
                             no trace will be sent periodically, unless forced
                             by baggage item. See `pkg/tracing/tracing.go` for
                             details.
      --objstore.config-file=&lt;bucket.config-yaml-path&gt;
                             Path to YAML file that contains object store
                             configuration.
      --objstore.config=&lt;bucket.config-yaml&gt;
                             Alternative to &#39;objstore.config-file&#39; flag. Object
                             store configuration in YAML.
  -l, --selector=&lt;name&gt;=&#34;&lt;value&gt;&#34; ...
                             Selects blocks based on label, e.g. &#39;-l
                             key1=&#34;value1&#34; -l key2=&#34;value2&#34;&#39;. All key value
                             pairs must match.
      --sort-by=FROM... ...  Sort by columns. It&#39;s also possible to sort by
                             multiple columns, e.g. &#39;--sort-by FROM --sort-by
                             UNTIL&#39;. I.e., if the &#39;FROM&#39; value is equal the rows
                             are then further sorted by the &#39;UNTIL&#39; value.</code></pre></div></div></div></div><footer class="bg-dark text-light"><div class="container text-center text-md-left"><div class="row py-5"><div class="col-12 col-md-6 col-lg mb-3 mb-lg-0"><img src=https://improbable-eng.github.io/thanos/icon-dark.png alt=Thanos width=45%></div><div class="col-12 col-md-6 col-lg"><h6 class=font-weight-bold>Documentation</h6><ul class=list-unstyled><li><a class=text-reset href=https://improbable-eng.github.io/thanos/getting-started.md>Getting Started</a></li><li><a class=text-reset href=https://improbable-eng.github.io/thanos/design.md>Design</a></li><li><a class=text-reset href=https://improbable-eng.github.io/thanos/storage.md>Storage</a></li><li><a class=text-reset href=https://improbable-eng.github.io/thanos/service-discovery.md>Service Discovery</a></li></ul></div><div class="col-12 col-md-6 col-lg"><h6 class=font-weight-bold>Community</h6><ul class=list-unstyled><li><a href=https://join.slack.com/t/improbable-eng/shared_invite/enQtMzQ1ODcyMzQ5MjM4LWY5ZWZmNGM2ODc5MmViNmQ3ZTA3ZTY3NzQwOTBlMTkzZmIxZTIxODk0OWU3YjZhNWVlNDU3MDlkZGViZjhkMjc class=text-reset><i class="fab fa-fw fa-slack"></i>Slack</a></li><li><a href=https://github.com/improbable-eng/thanos class=text-reset><i class="fab fa-fw fa-github"></i>GitHub</a></li><li><a href=https://twitter.com/ThanosMetrics class=text-reset><i class="fab fa-fw fa-twitter"></i>Twitter</a></li></ul></div><div class="col col-md-6 col-lg"><h6 class=font-weight-bold>About</h6><p>Thanos is an OSS licensed project as Apache License 2.0</p></div></div></div></footer><script src=https://code.jquery.com/jquery-3.3.1.slim.min.js integrity=sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js integrity=sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut crossorigin=anonymous></script><script src=https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js integrity=sha384-B0UglyR+jN6CkvvICOB2joaf5I4l3gm9GU6Hc1og6Ls7i6U/mkkaduKaBhlAXv9k crossorigin=anonymous></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-137374921-1','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script></body></html>